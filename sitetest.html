<!DOCTYPE html>
<html>
<head>
<!-- (c) APR Digital Studios -->
<title>SiteTest</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"></link>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"</script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
</head>
<script>
window.dataLayer = window.dataLayer || [];

function getValues(myText) {
   var lines = myText.split("\n");
   var numLines = lines.length;
   var i;
   var values = Array();
   for (i = 0; i < numLines; i++) {
     var line = lines[i];
     if (line != '') {
        value = line.split(' ')[1];
        values.push(value)
     }
   }
   return values;
}
function getNegativeValues(myText) {
   var lines = myText.split("\n");
   var numLines = lines.length;
   var i;
   var values = Array();
   for (i = 0; i < numLines; i++) {
     var line = lines[i];
     if (line != '') {
        value = line.split(' ')[1];
        values.push(-value)
     }
   }
   return values;
}

function getLabels(myText) {
   var lines = myText.split("\n");
   var numLines = lines.length;
   var i;
   var labels = Array();
   for (i = 0; i < numLines; i++) {
     var line = lines[i];
     if (line != '') {
        label = line.split(' ')[0];
        labels.push(label);
     }
   }
   return labels;
}

// Chart globals
dayChart = null;

// Register the chart plugin to all charts:
Chart.register(ChartDataLabels);
Chart.defaults.set('plugins.datalabels', {
  color: '#FFFFFF',
  anchor: 'end',
  align: 'bottom',
  font: { size: 10 },
  offset: 0,
  weight: 'bold'
});

function getDomains() {
     url="sitetest.php";
     jQuery.ajaxSetup({async:false});
     domains = [];
     $.get( url, function( data ) {
        domains = getLabels(data);
     }); // end get
     jQuery.ajaxSetup({async:true});
     return domains;
}
function createTable(domain,card) {
   var $table = $("<table>", { 'border':'0' });
   var $thead = $("<thead>");
   var $tbody = $("<tbody>");
   $thead.append($('<th>', { 'text':domain, 'colspan':'2' }));
   for (const [key, value] of Object.entries(card)) {
      newTr = $('<tr>');
      newTr.append($('<td>', { 'text':key, }));
      newTr.append($('<td>', { 'text':value, }));
      $tbody.append(newTr);
   }
   $table.append($thead);
   $table.append($tbody);
   $table.appendTo("body");
   return $table;
}

function renderCard(card,domain) {
     url="sitetest.php?domain="+domain;
     $.get( url, function( data ) {
      json_card = JSON.parse(data)
      table_card=createTable(domain,json_card)
      $("#card-"+card).html(table_card);
     }); // end get
}

$(document).ready(function(){
   domains=getDomains();
   for (var card = 0; card < domains.length; card++) {
      domain=domains[card]
      renderCard(card,domain)
   }
   // overall stats
   renderCard(5,'stats')

}); // end of doc ready

</script>
<body>
<div data-role="page">

	<div data-role="header">
	   <h1>Site Test</h1>
	</div>

	<div role="main" class="ui-content">

           <div class="ui-grid-c">
	      <div class="ui-block-a">
	         <div id="card-0"></div>
              </div>
	      <div class="ui-block-b">
	         <div id="card-1"></div>
              </div>
	      <div class="ui-block-c">
	         <div id="card-2"></div>
              </div>
	      <div class="ui-block-d">
	         <div id="card-3"></div>
              </div>
           </div><!-- grid-->

	   <hr/>
           <div class="ui-grid-a">
	      <div class="ui-block-a">
	         <div id="card-5"></div>
              </div>
           </div>
        </div><!-- main content -->

        <div data-role="footer">
            <center>APR Digital Studios - Site Test Stats</center>
       </div><!-- /footer -->

</div><!-- /page -->

</body>
</html>
